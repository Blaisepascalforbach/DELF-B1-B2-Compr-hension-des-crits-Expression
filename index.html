<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DELF B1/B2 – Télétravail</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-100 p-6">

  <div class="max-w-3xl mx-auto bg-white p-6 rounded-xl shadow">
    <h1 class="text-2xl font-bold mb-4">Expression écrite – DELF B2</h1>

    <textarea
      id="essay-area"
      class="w-full border p-4 rounded mb-4"
      rows="6"
      placeholder="Écris ton texte ici..."
    ></textarea>

    <button
      id="btn-ai-correct"
      class="w-full bg-indigo-600 text-white py-3 rounded font-bold"
    >
      Obtenir une correction IA
    </button>

    <div
      id="ai-feedback-container"
      class="hidden mt-6 p-4 bg-slate-900 text-white rounded"
    >
      <h3 class="font-bold mb-2">Analyse de l'examinateur IA</h3>
      <pre id="ai-response-text" class="whitespace-pre-wrap text-sm"></pre>
    </div>
  </div>

  <script>
    const btn = document.getElementById("btn-ai-correct");
    const area = document.getElementById("essay-area");
    const box = document.getElementById("ai-feedback-container");
    const out = document.getElementById("ai-response-text");

    async function getCorrection(text) {
      const prompt = `Évalue ce texte comme un examinateur DELF B2 et donne une correction détaillée.\n\nTEXTE :\n${text}`;

      const res = await fetch("/.netlify/functions/analyze", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt })
      });

      const data = await res.json();

      if (!res.ok) {
        throw new Error(
          data?.error
            ? JSON.stringify(data.error, null, 2)
            : "Erreur inconnue côté serveur"
        );
      }

      return data.text;
    }

    btn.onclick = async () => {
      const content = area.value.trim();
      if (content.length < 20) {
        alert("Texte trop court.");
        return;
      }

      out.textContent = "Analyse en cours…";
      box.classList.remove("hidden");

      try {
        const result = await getCorrection(content);
        out.textContent = result;
      } catch (err) {
        out.textContent =
          "ERREUR IA (message réel) :\n\n" + err.message;
      }
    };
  </script>

</body>
</html>
